<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>phpDox - Source of BTCController.php</title><link rel="stylesheet" type="text/css" href="../../css/style.css" media="screen"/><link rel="stylesheet" href="../../css/source.css"/><meta http-equiv="content-type" content="text/html; charset=utf-8"/></head><body><nav class="topnav"><ul><li><div class="logo"><span>/**</span>phpDox</div></li><li class="separator"><a href="../../index.html">Overview</a></li><li class="separator"><a href="../../namespaces.html">Namespaces</a></li><li><a href="../../interfaces.html">Interfaces</a></li><li><a href="../../classes.html">Classes</a></li><li class="separator"><a href="../../source/index.html">Source</a></li></ul></nav><div id="mainstage"><div class="box"><ul class="breadcrumb"><li><a href="../../index.html">Overview</a></li><li class="separator"><a href="../../source/index.html">Source</a></li></ul></div><h1>Source of file BTCController.php</h1><p>
                        Size: 13,573 Bytes - Last Modified: 2020-12-15T23:22:29+00:00</p><section><h2><small>../src/controller/</small>BTCController.php</h2><table class="source"><tr><td class="no"><a class="anker" href="#line1">1</a><a class="anker" href="#line2">2</a><a class="anker" href="#line3">3</a><a class="anker" href="#line4">4</a><a class="anker" href="#line5">5</a><a class="anker" href="#line6">6</a><a class="anker" href="#line7">7</a><a class="anker" href="#line8">8</a><a class="anker" href="#line9">9</a><a class="anker" href="#line10">10</a><a class="anker" href="#line11">11</a><a class="anker" href="#line12">12</a><a class="anker" href="#line13">13</a><a class="anker" href="#line14">14</a><a class="anker" href="#line15">15</a><a class="anker" href="#line16">16</a><a class="anker" href="#line17">17</a><a class="anker" href="#line18">18</a><a class="anker" href="#line19">19</a><a class="anker" href="#line20">20</a><a class="anker" href="#line21">21</a><a class="anker" href="#line22">22</a><a class="anker" href="#line23">23</a><a class="anker" href="#line24">24</a><a class="anker" href="#line25">25</a><a class="anker" href="#line26">26</a><a class="anker" href="#line27">27</a><a class="anker" href="#line28">28</a><a class="anker" href="#line29">29</a><a class="anker" href="#line30">30</a><a class="anker" href="#line31">31</a><a class="anker" href="#line32">32</a><a class="anker" href="#line33">33</a><a class="anker" href="#line34">34</a><a class="anker" href="#line35">35</a><a class="anker" href="#line36">36</a><a class="anker" href="#line37">37</a><a class="anker" href="#line38">38</a><a class="anker" href="#line39">39</a><a class="anker" href="#line40">40</a><a class="anker" href="#line41">41</a><a class="anker" href="#line42">42</a><a class="anker" href="#line43">43</a><a class="anker" href="#line44">44</a><a class="anker" href="#line45">45</a><a class="anker" href="#line46">46</a><a class="anker" href="#line47">47</a><a class="anker" href="#line48">48</a><a class="anker" href="#line49">49</a><a class="anker" href="#line50">50</a><a class="anker" href="#line51">51</a><a class="anker" href="#line52">52</a><a class="anker" href="#line53">53</a><a class="anker" href="#line54">54</a><a class="anker" href="#line55">55</a><a class="anker" href="#line56">56</a><a class="anker" href="#line57">57</a><a class="anker" href="#line58">58</a><a class="anker" href="#line59">59</a><a class="anker" href="#line60">60</a><a class="anker" href="#line61">61</a><a class="anker" href="#line62">62</a><a class="anker" href="#line63">63</a><a class="anker" href="#line64">64</a><a class="anker" href="#line65">65</a><a class="anker" href="#line66">66</a><a class="anker" href="#line67">67</a><a class="anker" href="#line68">68</a><a class="anker" href="#line69">69</a><a class="anker" href="#line70">70</a><a class="anker" href="#line71">71</a><a class="anker" href="#line72">72</a><a class="anker" href="#line73">73</a><a class="anker" href="#line74">74</a><a class="anker" href="#line75">75</a><a class="anker" href="#line76">76</a><a class="anker" href="#line77">77</a><a class="anker" href="#line78">78</a><a class="anker" href="#line79">79</a><a class="anker" href="#line80">80</a><a class="anker" href="#line81">81</a><a class="anker" href="#line82">82</a><a class="anker" href="#line83">83</a><a class="anker" href="#line84">84</a><a class="anker" href="#line85">85</a><a class="anker" href="#line86">86</a><a class="anker" href="#line87">87</a><a class="anker" href="#line88">88</a><a class="anker" href="#line89">89</a><a class="anker" href="#line90">90</a><a class="anker" href="#line91">91</a><a class="anker" href="#line92">92</a><a class="anker" href="#line93">93</a><a class="anker" href="#line94">94</a><a class="anker" href="#line95">95</a><a class="anker" href="#line96">96</a><a class="anker" href="#line97">97</a><a class="anker" href="#line98">98</a><a class="anker" href="#line99">99</a><a class="anker" href="#line100">100</a><a class="anker" href="#line101">101</a><a class="anker" href="#line102">102</a><a class="anker" href="#line103">103</a><a class="anker" href="#line104">104</a><a class="anker" href="#line105">105</a><a class="anker" href="#line106">106</a><a class="anker" href="#line107">107</a><a class="anker" href="#line108">108</a><a class="anker" href="#line109">109</a><a class="anker" href="#line110">110</a><a class="anker" href="#line111">111</a><a class="anker" href="#line112">112</a><a class="anker" href="#line113">113</a><a class="anker" href="#line114">114</a><a class="anker" href="#line115">115</a><a class="anker" href="#line116">116</a><a class="anker" href="#line117">117</a><a class="anker" href="#line118">118</a><a class="anker" href="#line119">119</a><a class="anker" href="#line120">120</a><a class="anker" href="#line121">121</a><a class="anker" href="#line122">122</a><a class="anker" href="#line123">123</a><a class="anker" href="#line124">124</a><a class="anker" href="#line125">125</a><a class="anker" href="#line126">126</a><a class="anker" href="#line127">127</a><a class="anker" href="#line128">128</a><a class="anker" href="#line129">129</a><a class="anker" href="#line130">130</a><a class="anker" href="#line131">131</a><a class="anker" href="#line132">132</a><a class="anker" href="#line133">133</a><a class="anker" href="#line134">134</a><a class="anker" href="#line135">135</a><a class="anker" href="#line136">136</a><a class="anker" href="#line137">137</a><a class="anker" href="#line138">138</a><a class="anker" href="#line139">139</a><a class="anker" href="#line140">140</a><a class="anker" href="#line141">141</a><a class="anker" href="#line142">142</a><a class="anker" href="#line143">143</a><a class="anker" href="#line144">144</a><a class="anker" href="#line145">145</a><a class="anker" href="#line146">146</a><a class="anker" href="#line147">147</a><a class="anker" href="#line148">148</a><a class="anker" href="#line149">149</a><a class="anker" href="#line150">150</a><a class="anker" href="#line151">151</a><a class="anker" href="#line152">152</a><a class="anker" href="#line153">153</a><a class="anker" href="#line154">154</a><a class="anker" href="#line155">155</a><a class="anker" href="#line156">156</a><a class="anker" href="#line157">157</a><a class="anker" href="#line158">158</a><a class="anker" href="#line159">159</a><a class="anker" href="#line160">160</a><a class="anker" href="#line161">161</a><a class="anker" href="#line162">162</a><a class="anker" href="#line163">163</a><a class="anker" href="#line164">164</a><a class="anker" href="#line165">165</a><a class="anker" href="#line166">166</a><a class="anker" href="#line167">167</a><a class="anker" href="#line168">168</a><a class="anker" href="#line169">169</a><a class="anker" href="#line170">170</a><a class="anker" href="#line171">171</a><a class="anker" href="#line172">172</a><a class="anker" href="#line173">173</a><a class="anker" href="#line174">174</a><a class="anker" href="#line175">175</a><a class="anker" href="#line176">176</a><a class="anker" href="#line177">177</a><a class="anker" href="#line178">178</a><a class="anker" href="#line179">179</a><a class="anker" href="#line180">180</a><a class="anker" href="#line181">181</a><a class="anker" href="#line182">182</a><a class="anker" href="#line183">183</a><a class="anker" href="#line184">184</a><a class="anker" href="#line185">185</a><a class="anker" href="#line186">186</a><a class="anker" href="#line187">187</a><a class="anker" href="#line188">188</a><a class="anker" href="#line189">189</a><a class="anker" href="#line190">190</a><a class="anker" href="#line191">191</a><a class="anker" href="#line192">192</a><a class="anker" href="#line193">193</a><a class="anker" href="#line194">194</a><a class="anker" href="#line195">195</a><a class="anker" href="#line196">196</a><a class="anker" href="#line197">197</a><a class="anker" href="#line198">198</a><a class="anker" href="#line199">199</a><a class="anker" href="#line200">200</a><a class="anker" href="#line201">201</a><a class="anker" href="#line202">202</a><a class="anker" href="#line203">203</a><a class="anker" href="#line204">204</a><a class="anker" href="#line205">205</a><a class="anker" href="#line206">206</a><a class="anker" href="#line207">207</a><a class="anker" href="#line208">208</a><a class="anker" href="#line209">209</a><a class="anker" href="#line210">210</a><a class="anker" href="#line211">211</a><a class="anker" href="#line212">212</a><a class="anker" href="#line213">213</a><a class="anker" href="#line214">214</a><a class="anker" href="#line215">215</a><a class="anker" href="#line216">216</a><a class="anker" href="#line217">217</a><a class="anker" href="#line218">218</a><a class="anker" href="#line219">219</a><a class="anker" href="#line220">220</a><a class="anker" href="#line221">221</a><a class="anker" href="#line222">222</a><a class="anker" href="#line223">223</a><a class="anker" href="#line224">224</a><a class="anker" href="#line225">225</a><a class="anker" href="#line226">226</a><a class="anker" href="#line227">227</a><a class="anker" href="#line228">228</a><a class="anker" href="#line229">229</a><a class="anker" href="#line230">230</a><a class="anker" href="#line231">231</a><a class="anker" href="#line232">232</a><a class="anker" href="#line233">233</a><a class="anker" href="#line234">234</a><a class="anker" href="#line235">235</a><a class="anker" href="#line236">236</a><a class="anker" href="#line237">237</a><a class="anker" href="#line238">238</a><a class="anker" href="#line239">239</a><a class="anker" href="#line240">240</a><a class="anker" href="#line241">241</a><a class="anker" href="#line242">242</a><a class="anker" href="#line243">243</a><a class="anker" href="#line244">244</a><a class="anker" href="#line245">245</a><a class="anker" href="#line246">246</a><a class="anker" href="#line247">247</a><a class="anker" href="#line248">248</a><a class="anker" href="#line249">249</a><a class="anker" href="#line250">250</a><a class="anker" href="#line251">251</a><a class="anker" href="#line252">252</a><a class="anker" href="#line253">253</a><a class="anker" href="#line254">254</a><a class="anker" href="#line255">255</a><a class="anker" href="#line256">256</a><a class="anker" href="#line257">257</a><a class="anker" href="#line258">258</a><a class="anker" href="#line259">259</a><a class="anker" href="#line260">260</a><a class="anker" href="#line261">261</a><a class="anker" href="#line262">262</a><a class="anker" href="#line263">263</a><a class="anker" href="#line264">264</a><a class="anker" href="#line265">265</a><a class="anker" href="#line266">266</a><a class="anker" href="#line267">267</a><a class="anker" href="#line268">268</a><a class="anker" href="#line269">269</a><a class="anker" href="#line270">270</a><a class="anker" href="#line271">271</a><a class="anker" href="#line272">272</a><a class="anker" href="#line273">273</a><a class="anker" href="#line274">274</a><a class="anker" href="#line275">275</a><a class="anker" href="#line276">276</a><a class="anker" href="#line277">277</a><a class="anker" href="#line278">278</a><a class="anker" href="#line279">279</a><a class="anker" href="#line280">280</a><a class="anker" href="#line281">281</a><a class="anker" href="#line282">282</a><a class="anker" href="#line283">283</a><a class="anker" href="#line284">284</a><a class="anker" href="#line285">285</a><a class="anker" href="#line286">286</a><a class="anker" href="#line287">287</a><a class="anker" href="#line288">288</a><a class="anker" href="#line289">289</a><a class="anker" href="#line290">290</a><a class="anker" href="#line291">291</a><a class="anker" href="#line292">292</a><a class="anker" href="#line293">293</a><a class="anker" href="#line294">294</a><a class="anker" href="#line295">295</a><a class="anker" href="#line296">296</a><a class="anker" href="#line297">297</a><a class="anker" href="#line298">298</a><a class="anker" href="#line299">299</a><a class="anker" href="#line300">300</a><a class="anker" href="#line301">301</a><a class="anker" href="#line302">302</a><a class="anker" href="#line303">303</a><a class="anker" href="#line304">304</a><a class="anker" href="#line305">305</a><a class="anker" href="#line306">306</a><a class="anker" href="#line307">307</a><a class="anker" href="#line308">308</a><a class="anker" href="#line309">309</a><a class="anker" href="#line310">310</a></td><td class="line"><div id="line1"><pre><span class="token T_OPEN_TAG">&lt;?php</span></pre></div><div id="line2"><pre><span class="token T_NAMESPACE">namespace</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">controller</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line3"><br/></div><div id="line4"><pre><span class="token T_USE">use</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">contract</span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Controller</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line5"><pre><span class="token T_USE">use</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">helper</span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Utility</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line6"><pre><span class="token T_USE">use</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">contract</span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line7"><pre><span class="token T_USE">use</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">model</span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Model</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line8"><pre><span class="token T_USE">use</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">comm</span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Link</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line9"><pre><span class="token T_USE">use</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">contract</span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Event</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line10"><pre><span class="token T_USE">use</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Exception</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line11"><br/></div><div id="line12"><pre><span class="token T_CLASS">class</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">BTCController</span><span class="token T_WHITESPACE"> </span><span class="token T_EXTENDS">extends</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Controller</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line13"><pre><span class="token T_WHITESPACE">	</span><span class="token T_DOC_COMMENT">/** @return void  */</span></pre></div><div id="line14"><pre><span class="token T_WHITESPACE">	</span><span class="token T_STATIC">static</span><span class="token T_WHITESPACE"> </span><span class="token T_FUNCTION">function</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">getUserWallet</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">Model</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$forceNew</span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_STRING">Model</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line15"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line16"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCWallet</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line17"><pre><span class="token T_WHITESPACE">		</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">SessionController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">verifyCSRF</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line18"><pre><span class="token T_WHITESPACE">			</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_EXCLAMATION_MARK">!</span><span class="token T_VARIABLE">$forceNew</span><span class="token T_WHITESPACE"> </span><span class="token T_BOOLEAN_AND">&amp;&amp;</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$wallets</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCWallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getAllAtState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">STATE_DEFAULT</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'user'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line19"><pre><span class="token T_WHITESPACE">				</span><span class="token T_RETURN">return</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCWallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$wallets</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_CONSTANT_ENCAPSED_STRING">'id'</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line20"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line21"><pre><span class="token T_WHITESPACE">				</span><span class="token T_RETURN">return</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">Wallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">newHDAccount</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line22"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line23"><pre><span class="token T_WHITESPACE">		</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line24"><pre><span class="token T_WHITESPACE">	</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line25"><pre><span class="token T_WHITESPACE">	</span><span class="token T_STATIC">static</span><span class="token T_WHITESPACE"> </span><span class="token T_FUNCTION">function</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">getUsableAddress</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">Model</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">bool</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$forceNew</span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_PHPDOX_QUESTION_MARK">?</span><span class="token T_STRING">Model</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line26"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line27"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCWallet</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line28"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCAddress</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line29"><pre><span class="token T_WHITESPACE">		</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">SessionController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">verifyCSRF</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line30"><pre><span class="token T_WHITESPACE">			</span><span class="token T_VARIABLE">$callbackUrl</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_CONSTANT_ENCAPSED_STRING">'https://blockstale.com/hooks-btx'</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line31"><pre><span class="token T_WHITESPACE">			</span><span class="token T_VARIABLE">$wallets</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCWallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getGeneric</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">"WHERE user='"</span><span class="token T_PHPDOX_DOT">.</span><span class="token T_VARIABLE">$user</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_DOT">.</span><span class="token T_CONSTANT_ENCAPSED_STRING">"' AND archived&lt;&gt;'1' ORDER BY indexx ASC"</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line32"><pre><span class="token T_WHITESPACE">			</span><span class="token T_FOREACH">foreach</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$wallets</span><span class="token T_WHITESPACE"> </span><span class="token T_AS">as</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$i</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$wallet</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line33"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCWallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$wallet</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_CONSTANT_ENCAPSED_STRING">'id'</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line34"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">null</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line35"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$xPub</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'xpub'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line36"><pre><span class="token T_WHITESPACE">				</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$forceNew</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line37"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">ReceiveV2</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">generate</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$callbackUrl</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">GAP_LIMIT</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line38"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span></pre></div><div id="line39"><pre><span class="token T_WHITESPACE">				</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$freeAddresses</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getAllAtState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">STATE_DEFAULT</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'wallet'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line40"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$freeAddresses</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_CONSTANT_ENCAPSED_STRING">'id'</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line41"><pre><span class="token T_WHITESPACE">					</span><span class="token T_COMMENT">// $Blockchain-&gt;ReceiveV2-&gt;balanceUpdate($btcAddress-&gt;getProperty('address'),$xPub,$callbackUrl);</span></pre></div><div id="line42"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line43"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$addresses</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getGeneric</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">"WHERE wallet='"</span><span class="token T_PHPDOX_DOT">.</span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_DOT">.</span><span class="token T_CONSTANT_ENCAPSED_STRING">"' ORDER BY indexx DESC LIMIT 1"</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line44"><pre><span class="token T_WHITESPACE">					</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$addresses</span><span class="token T_WHITESPACE"> </span><span class="token T_BOOLEAN_AND">&amp;&amp;</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$addresses</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_CONSTANT_ENCAPSED_STRING">'indexx'</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_GT">&gt;</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line45"><pre><span class="token T_WHITESPACE">						</span><span class="token T_VARIABLE">$gapResponse</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">ReceiveV2</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">checkAddressGap</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$xPub</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line46"><pre><span class="token T_WHITESPACE">						</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$gapResponse</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getPayloadValue</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'gap'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_IS_SMALLER_OR_EQUAL">&lt;=</span><span class="token T_STRING">GAP_LIMIT_THRESHOLD</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line47"><pre><span class="token T_WHITESPACE">							</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">ReceiveV2</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">generate</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$callbackUrl</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">GAP_LIMIT</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line48"><pre><span class="token T_WHITESPACE">						</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line49"><pre><span class="token T_WHITESPACE">							</span><span class="token T_CONTINUE">continue</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line50"><pre><span class="token T_WHITESPACE">							</span><span class="token T_THROW">throw</span><span class="token T_WHITESPACE"> </span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Exception</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Address threshold reached, please try again later'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line51"><pre><span class="token T_WHITESPACE">							</span><span class="token T_COMMENT">//Generate new addresses here and pre-fill them with petty cash without a callback</span></pre></div><div id="line52"><pre><span class="token T_WHITESPACE">						</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line53"><pre><span class="token T_WHITESPACE">					</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line54"><pre><span class="token T_WHITESPACE">						</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">ReceiveV2</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">generate</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$callbackUrl</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">GAP_LIMIT</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line55"><pre><span class="token T_WHITESPACE">					</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line56"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line57"><pre><span class="token T_WHITESPACE">				</span><span class="token T_RETURN">return</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line58"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line59"><pre><span class="token T_WHITESPACE">			</span><span class="token T_STRING">Utility</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">log</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Wow... couldnt find a usable address'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line60"><pre><span class="token T_WHITESPACE">			</span><span class="token T_COMMENT">// return null;</span></pre></div><div id="line61"><pre><span class="token T_WHITESPACE">			</span><span class="token T_VARIABLE">$btcWallet</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">BTCController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getUserWallet</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">true</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line62"><pre><span class="token T_WHITESPACE">			</span><span class="token T_RETURN">return</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">BTCController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getUsableAddress</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line63"><pre><span class="token T_WHITESPACE">		</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line64"><pre><span class="token T_WHITESPACE">	</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line65"><pre><span class="token T_WHITESPACE">	</span><span class="token T_STATIC">static</span><span class="token T_WHITESPACE"> </span><span class="token T_FUNCTION">function</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">send</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line66"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line67"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line68"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$request</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line69"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$response</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line70"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line71"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Entry</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line72"><pre><span class="token T_WHITESPACE">		</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">SessionController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">verifyCSRF</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line73"><pre><span class="token T_WHITESPACE">			</span><span class="token T_TRY">try</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line74"><pre><span class="token T_WHITESPACE">				</span><span class="token T_STRING">ul</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParams</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line75"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Blockchain</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">Wallet</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">send</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">BTCController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getUserWallet</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'indexx'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">null</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$admin</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getPref</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">CONFIG_BLOCKCHAIN_SATOSHI_PER_BYTE</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">null</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line76"><pre><span class="token T_WHITESPACE">				</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line77"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$entry</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Entry</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">insertMap</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span></pre></div><div id="line78"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'name'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_CONSTANT_ENCAPSED_STRING">'DR:BTC Payout'</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line79"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'description'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_CONSTANT_ENCAPSED_STRING">'DR:BTC Payout'</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line80"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'party'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$admin</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line81"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'coparty'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$user</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line82"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'type'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_STRING">ACCOUNT_ENTRY_TYPE_OUT</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line83"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'account'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_STRING">ACCOUNT_BALANCE</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line84"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'transaction'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line85"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'cleared_number'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line86"><pre><span class="token T_WHITESPACE">						</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'cleared_unit'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line87"><pre><span class="token T_WHITESPACE">					</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line88"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'explorer'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'https://www.blockchain.com/btc/tx/'</span><span class="token T_PHPDOX_DOT">.</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'hash'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line89"><pre><span class="token T_WHITESPACE">					</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$entry</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line90"><pre><span class="token T_WHITESPACE">						</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Transfer Completed'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Transfer Completed'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line91"><pre><span class="token T_WHITESPACE">					</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line92"><pre><span class="token T_WHITESPACE">						</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Transfer Completed, but not booked'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Transfer Completed, but not booked'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line93"><pre><span class="token T_WHITESPACE">					</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line94"><pre><span class="token T_WHITESPACE">					</span><span class="token T_STRING">Event</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">trigger</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$entry</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">ACTION_TRANSFER_COMPLETED</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line95"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line96"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Voucher Redemption Failed'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Voucher Redemption Failed'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line97"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setStatusCode</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">511</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line98"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line99"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_CATCH">catch</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NS_SEPARATOR">\</span><span class="token T_STRING">Exception</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$e</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line100"><pre><span class="token T_WHITESPACE">				</span><span class="token T_STRING">Utility</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">log</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line101"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setStatusCode</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">500</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line102"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line103"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line104"><pre><span class="token T_WHITESPACE">		</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line105"><pre><span class="token T_WHITESPACE">	</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line106"><pre><span class="token T_WHITESPACE">	</span><span class="token T_STATIC">static</span><span class="token T_WHITESPACE"> </span><span class="token T_FUNCTION">function</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">pingBTX</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line107"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$request</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line108"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$response</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line109"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line110"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line111"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line112"><pre><span class="token T_WHITESPACE">		</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">SessionController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">verifyCSRF</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line113"><pre><span class="token T_WHITESPACE">			</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getVariable</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'id'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line114"><pre><span class="token T_WHITESPACE">			</span><span class="token T_SWITCH">switch</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line115"><pre><span class="token T_WHITESPACE">				</span><span class="token T_CASE">case</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">STATE_PENDING</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line116"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'status'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'pending'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line117"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC Payment Pending'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC Payment Pending'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_INFO</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line118"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_BREAK">break</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line119"><pre><span class="token T_WHITESPACE">				</span><span class="token T_CASE">case</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">STATE_APPROVED</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line120"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'status'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'approved'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line121"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC Payment Approved'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC Payment Approved'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_INFO</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line122"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_BREAK">break</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line123"><pre><span class="token T_WHITESPACE">				</span><span class="token T_CASE">case</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">STATE_COMPLETED</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line124"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">AccountController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getBalance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">CURRENCY_NAIRA</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line125"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$balanceQTY2</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">AccountController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getBalance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">CURRENCY_NAIRA</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">ACCOUNT_SALES</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line126"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'status'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'success'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line127"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'balance_number'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getNumber</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line128"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'balance_unit'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getUnit</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line129"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'sales_balance_number'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$balanceQTY2</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getNumber</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line130"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'sales_balance_unit'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$balanceQTY2</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getUnit</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line131"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC Payment Successful'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC Payment Successful'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_INFO</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line132"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_BREAK">break</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line133"><pre><span class="token T_WHITESPACE">				</span><span class="token T_CASE">case</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">STATE_ABORTED</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line134"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'status'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'aborted'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line135"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC payment aborted'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC payment aborted'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_INFO</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line136"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_BREAK">break</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line137"><pre><span class="token T_WHITESPACE">				</span><span class="token T_CASE">case</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">STATE_DECLINED</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line138"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'status'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'declined'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line139"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC payment declined'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC payment declined'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_INFO</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line140"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_BREAK">break</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line141"><pre><span class="token T_WHITESPACE">				</span><span class="token T_DEFAULT">default</span><span class="token T_PHPDOX_COLON">:</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line142"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'status'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'undefined'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line143"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Transaction state unrecognized'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Transaction state unrecognized'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_INFO</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line144"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line145"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line146"><pre><span class="token T_WHITESPACE">		</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line147"><pre><span class="token T_WHITESPACE">	</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line148"><pre><span class="token T_WHITESPACE">	</span><span class="token T_STATIC">static</span><span class="token T_WHITESPACE"> </span><span class="token T_FUNCTION">function</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">hookBTX</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line149"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$request</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line150"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line151"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line152"><pre><span class="token T_WHITESPACE">		</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">true</span><span class="token T_WHITESPACE"> </span><span class="token T_BOOLEAN_OR">||</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">SessionController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">verifyCSRF</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line153"><pre><span class="token T_WHITESPACE">			</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getVariable</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'id'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line154"><pre><span class="token T_WHITESPACE">			</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'confirmations'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line155"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">STATE_APPROVED</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Transaction verified by provider'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line156"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line157"><pre><span class="token T_WHITESPACE">			</span><span class="token T_ECHO">echo</span><span class="token T_WHITESPACE"> </span><span class="token T_CONSTANT_ENCAPSED_STRING">"*ok*"</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line158"><pre><span class="token T_WHITESPACE">			</span><span class="token T_COMMENT">/*</span></pre></div><div id="line159"><pre><span class="token T_COMMENT">				transaction_hash - The payment transaction hash.</span></pre></div><div id="line160"><pre><span class="token T_COMMENT">				address - The destination bitcoin address (part of your xPub account).</span></pre></div><div id="line161"><pre><span class="token T_COMMENT">				confirmations - The number of confirmations of this transaction.</span></pre></div><div id="line162"><pre><span class="token T_COMMENT">				value - The value of the payment received (in satoshi, so divide by 100,000,000 to get the value in BTC).</span></pre></div><div id="line163"><pre><span class="token T_COMMENT">				{custom parameter} - Any parameters included in the callback URL will be passed back to the callback URL in the notification. You can use this functionality to include parameters in your callback URL like invoice_id or customer_id to track which payments are associated with which of your customers.</span></pre></div><div id="line164"><pre><span class="token T_COMMENT">			*/</span></pre></div><div id="line165"><pre><span class="token T_WHITESPACE">		</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line166"><pre><span class="token T_WHITESPACE">	</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line167"><pre><span class="token T_WHITESPACE">	</span><span class="token T_STATIC">static</span><span class="token T_WHITESPACE"> </span><span class="token T_FUNCTION">function</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">initReceivePayment</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line168"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$request</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line169"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$response</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line170"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line171"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line172"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line173"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line174"><pre><span class="token T_WHITESPACE">		</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">SessionController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">verifyCSRF</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line175"><pre><span class="token T_WHITESPACE">			</span><span class="token T_TRY">try</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line176"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$crypto</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'currency'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line177"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$fiat</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value-unit'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line178"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$usd</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">CURRENCY_USD</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line179"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$rate</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">APIController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getFX</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$crypto</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$usd</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_MULT">*</span><span class="token T_STRING">APIController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getFX</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$usd</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$fiat</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line180"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$fee</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">number_format</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_MULT">*</span><span class="token T_STRING">APIController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getMerchantCommission</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_DIV">/</span><span class="token T_LNUMBER">100</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'.'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">''</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line181"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$valueFiat</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line182"><br/></div><div id="line183"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$valueFiat</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line184"><pre><span class="token T_WHITESPACE">				</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$user</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getPref</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">CONFIG_MERCHANTS_CHARGE_COMMISSION_ON_SALE</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">true</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line185"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_WHITESPACE"> </span><span class="token T_PLUS_EQUAL">+=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line186"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line187"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_WHITESPACE"> </span><span class="token T_PLUS_EQUAL">+=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line188"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line189"><br/></div><div id="line190"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$cryptoValue</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">number_format</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$valueFiat</span><span class="token T_PHPDOX_DIV">/</span><span class="token T_VARIABLE">$rate</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">8</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'.'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">''</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line191"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$totalCrypto</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">number_format</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_PHPDOX_DIV">/</span><span class="token T_VARIABLE">$rate</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">8</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'.'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">''</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line192"><br/></div><div id="line193"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">insertMap</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span></pre></div><div id="line194"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'name'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Merchant BTC Payment'</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line195"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'description'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'desc'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line196"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'user'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$user</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line197"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'type'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_STRING">TX_TYPE_MERCHANT</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line198"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_CONSTANT_ENCAPSED_STRING">'NULL'</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line199"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line200"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$fiat</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line201"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line202"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$fiat</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line203"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$rate</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line204"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$crypto</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line205"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'cleared_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line206"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'cleared_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$fiat</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line207"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line208"><br/></div><div id="line209"><pre><span class="token T_WHITESPACE">				</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">BTCController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getUsableAddress</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line210"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">APIController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getBTCAddressBalance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line211"><br/></div><div id="line212"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">updateMap</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'balance0_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getNumber</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'balance0_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getUnit</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line213"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">STATE_PENDING</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC address engaged'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line214"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">STATE_PENDING</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'New BTC transaction initiated'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line215"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line216"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'desc'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'description'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line217"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$cryptoValue</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">8</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line218"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value_number'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line219"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">number_format</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_DIV">/</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_number'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">8</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'.'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">''</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line220"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line221"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'total-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$totalCrypto</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line222"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'total-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line223"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'symbol-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$crypto</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getCache</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line224"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'symbol-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$fiat</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getCache</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line225"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'endpoint'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">Link</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getBaseURL</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line226"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'txid'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line227"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$qrurl</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">urlencode</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'bitcoin:'</span><span class="token T_PHPDOX_DOT">.</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_DOT">.</span><span class="token T_PHPDOX_DOUBLE_QUOTES">"</span><span class="token T_ENCAPSED_AND_WHITESPACE">?&amp;amount=</span><span class="token T_VARIABLE">$totalCrypto</span><span class="token T_ENCAPSED_AND_WHITESPACE">&amp;message=Blockstale Payments, LLC</span><span class="token T_PHPDOX_DOUBLE_QUOTES">"</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line228"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'qr'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_PHPDOX_DOUBLE_QUOTES">"</span><span class="token T_ENCAPSED_AND_WHITESPACE">https://chart.googleapis.com/chart?chs=250x250&amp;cht=qr&amp;chl=</span><span class="token T_VARIABLE">$qrurl</span><span class="token T_PHPDOX_DOUBLE_QUOTES">"</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line229"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fiat/crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">1</span><span class="token T_PHPDOX_DIV">/</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_number'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line230"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'crypto/fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_number'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line231"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line232"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Error initializing transaction 2'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Error initializing transaction 2'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line233"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line234"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_CATCH">catch</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">Exception</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$e</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line235"><pre><span class="token T_WHITESPACE">				</span><span class="token T_STRING">Utility</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">log</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line236"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line237"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setStatusCode</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">500</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line238"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line239"><pre><span class="token T_WHITESPACE">			</span><span class="token T_COMMENT">// Utility::log($response-&gt;getPayload());</span></pre></div><div id="line240"><pre><span class="token T_WHITESPACE">		</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line241"><pre><span class="token T_WHITESPACE">	</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line242"><pre><span class="token T_WHITESPACE">	</span><span class="token T_STATIC">static</span><span class="token T_WHITESPACE"> </span><span class="token T_FUNCTION">function</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">initTopup</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line243"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$request</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line244"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$response</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line245"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line246"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line247"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line248"><pre><span class="token T_WHITESPACE">		</span><span class="token T_GLOBAL">global</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line249"><pre><span class="token T_WHITESPACE">		</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">SessionController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">verifyCSRF</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line250"><pre><span class="token T_WHITESPACE">			</span><span class="token T_TRY">try</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line251"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$crypto</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$request</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getParam</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'currency'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line252"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$usd</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">CURRENCY_USD</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line253"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$fiat</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$Currency</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getInstance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">CURRENCY_NAIRA</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line254"><br/></div><div id="line255"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$fx</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">APIController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getFX</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$crypto</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$usd</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line256"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$fx1</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">APIController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getFX</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$usd</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$fiat</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line257"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$rate</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$fx</span><span class="token T_PHPDOX_MULT">*</span><span class="token T_VARIABLE">$fx1</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line258"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$fee</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">bcmul</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line259"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line260"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$totalCrypto</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">bcmul</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">8</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line261"><br/></div><div id="line262"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$BTCTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">insertMap</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span></pre></div><div id="line263"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'name'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Inbound BTC Transaction'</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line264"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'description'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC Balance Top Up'</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line265"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'user'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$user</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line266"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'type'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_STRING">TX_TYPE_TOPUP</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line267"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">10</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line268"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$fiat</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line269"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line270"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$fiat</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line271"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$rate</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line272"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$crypto</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line273"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'cleared_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_STRING">bcmul</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line274"><pre><span class="token T_WHITESPACE">					</span><span class="token T_CONSTANT_ENCAPSED_STRING">'cleared_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$crypto</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span></pre></div><div id="line275"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line276"><br/></div><div id="line277"><pre><span class="token T_WHITESPACE">				</span><span class="token T_IF">if</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">BTCController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getUsableAddress</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$admin</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line278"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">APIController</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getBTCAddressBalance</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line279"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">updateMap</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_OPEN_SQUARE">[</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'balance0_number'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getNumber</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'balance0_unit'</span><span class="token T_DOUBLE_ARROW">=&gt;</span><span class="token T_VARIABLE">$balanceQTY</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getUnit</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_SQUARE">]</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line280"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">STATE_PENDING</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'BTC address engaged'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line281"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setState</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">STATE_PENDING</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$user</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'New BTC transaction initiated'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line282"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line283"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'desc'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'description'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line284"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">bcmul</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">8</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line285"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'value-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line286"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">bcmul</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">8</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line287"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'fee-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$fee</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line288"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'total-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$totalCrypto</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line289"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'total-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$totalFiat</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line290"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'symbol-crypto'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$crypto</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getCache</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line291"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'symbol-fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$fiat</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getCache</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line292"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'symbol-fiat-0'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$usd</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getCache</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line293"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'endpoint'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">Link</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">getBaseURL</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">false</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line294"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'txid'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getID</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line295"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$qrurl</span><span class="token T_WHITESPACE"> </span><span class="token T_PHPDOX_EQUAL">=</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">urlencode</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcAddress</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'address'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line296"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'qr'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_PHPDOX_DOUBLE_QUOTES">"</span><span class="token T_ENCAPSED_AND_WHITESPACE">https://chart.googleapis.com/chart?chs=250x250&amp;cht=qr&amp;chl=</span><span class="token T_VARIABLE">$qrurl</span><span class="token T_PHPDOX_DOUBLE_QUOTES">"</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line297"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'usd/fiat'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$fx1</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line298"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addPayload</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'crypto/usd'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">bcadd</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$btcTransaction</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getProperty</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'rate_number'</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">0</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_LNUMBER">2</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line299"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_ELSE">else</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line300"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setStatusCode</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">500</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line301"><pre><span class="token T_WHITESPACE">					</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Error initializin BTC Topup'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_CONSTANT_ENCAPSED_STRING">'Error initializin BTC Topup'</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line302"><pre><span class="token T_WHITESPACE">				</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line303"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span><span class="token T_CATCH">catch</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_STRING">Exception</span><span class="token T_WHITESPACE"> </span><span class="token T_VARIABLE">$e</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_OPEN_CURLY">{</span></pre></div><div id="line304"><pre><span class="token T_WHITESPACE">				</span><span class="token T_STRING">Utility</span><span class="token T_DOUBLE_COLON">::</span><span class="token T_STRING">log</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line305"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">addMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_NEW">new</span><span class="token T_WHITESPACE"> </span><span class="token T_STRING">Message</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_VARIABLE">$e</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">getMessage</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_COMMA">,</span><span class="token T_STRING">THEME_SECONDARY</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line306"><pre><span class="token T_WHITESPACE">				</span><span class="token T_VARIABLE">$response</span><span class="token T_OBJECT_OPERATOR">-&gt;</span><span class="token T_STRING">setStatusCode</span><span class="token T_PHPDOX_OPEN_BRACKET">(</span><span class="token T_LNUMBER">500</span><span class="token T_PHPDOX_CLOSE_BRACKET">)</span><span class="token T_PHPDOX_SEMICOLON">;</span></pre></div><div id="line307"><pre><span class="token T_WHITESPACE">			</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line308"><pre><span class="token T_WHITESPACE">		</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line309"><pre><span class="token T_WHITESPACE">	</span><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div><div id="line310"><pre><span class="token T_PHPDOX_CLOSE_CURLY">}</span></pre></div></td></tr></table></section></div><footer><span>Generated using phpDox 0.12.0 - Copyright (C) 2010 - 2021 by Arne Blankerts and Contributors</span></footer></body></html>
